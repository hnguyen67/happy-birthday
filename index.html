<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>HAPPYBIRTHDAY</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <style>
    /* ===== Overlay video/iframe ===== */
    .intro-overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.85);
      display:none; align-items:center; justify-content:center;
      z-index:9999; padding:16px;
    }
    .intro-wrap{
      width:min(900px,96vw); aspect-ratio:16/9; position:relative;
      background:#000; border-radius:12px; overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.5);
    }
    .intro-wrap video,.intro-wrap iframe{
      width:100%; height:100%; border:0; display:block; background:#000;
    }
    .intro-skip{
      position:absolute; right:12px; top:12px; padding:10px 16px; border:0; border-radius:999px;
      font-weight:700; cursor:pointer; background:rgba(255,255,255,.12); color:#fff; backdrop-filter:blur(6px);
    }

    /* ===== Ch·ªØ ƒë·ªïi m√†u c·∫ßu v·ªìng ===== */
    .rainbow-text{
      font-size: 2.9em;
      font-weight: 900;
      background: linear-gradient(45deg, #4649fd, #f141b7, #eeba0f);
      background-size: 800% 800%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: rainbowMove 4s ease-in-out infinite;
      text-shadow: 0 0 40px rgba(255,255,255,0.5);
      margin: 0;
      filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
    }
    @keyframes rainbowMove{
      0%,100%{ background-position: 0% 50%; }
      50%    { background-position: 100% 50%; }
    }

    /* ===== Hi·ªáu ·ª©ng rung khi sai m·∫≠t kh·∫©u ===== */
    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }
  </style>
</head>

<body class="preload">
  <!-- N·ªÄN & HI·ªÜU ·ª®NG (ƒë√£ c√≥ style trong style.css c·ªßa b·∫°n) -->
  <div class="bubbles" id="bubbles"></div>
  <div class="bg-hearts" id="bgHearts"></div>

  <!-- OVERLAY INTRO -->
  <div id="introOverlay" class="intro-overlay" aria-hidden="true">
    <div class="intro-wrap" id="introWrap">
      <!-- Ph√°t link Vercel qua iframe -->
      <iframe id="introFrame"
              allow="autoplay; fullscreen"
              allowfullscreen
              referrerpolicy="no-referrer"
              sandbox="allow-same-origin allow-scripts allow-forms allow-popups">
      </iframe>
      <!-- N√∫t b·ªè qua -->
      <button id="skipBtn" class="intro-skip" type="button">B·ªè qua ¬ª</button>
    </div>
  </div>

  <!-- M√ÄN H√åNH NH·∫¨P M·∫¨T KH·∫®U -->
  <div class="container">
    <div class="calculator-screen" id="calculatorScreen">
      <div class="input-avatar-row">
        <div class="avatar-square">
          <img id="avatarImg" src="img/gaixenh9.jpg" alt="Avatar" style="display:block;">
        </div>

        <div class="input-and-keypad">
          <div class="calculator-title">Nh·∫≠p ng√†y sinh c·ªßa b·∫°n</div>

          <input
            type="password"
            class="display"
            id="display"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            maxlength="8"
            inputmode="numeric"
            autocomplete="off"
            aria-label="Nh·∫≠p m·∫≠t kh·∫©u 8 s·ªë"
          >

          <div class="buttons" aria-label="B√†n ph√≠m s·ªë">
            <button class="btn btn-number" type="button" onclick="appendToDisplay('1')">1</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('2')">2</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('3')">3</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('4')">4</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('5')">5</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('6')">6</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('7')">7</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('8')">8</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('9')">9</button>
            <button class="btn btn-clear"  type="button" onclick="clearDisplay()">C</button>
            <button class="btn btn-number" type="button" onclick="appendToDisplay('0')">0</button>
            <button class="btn btn-enter"  type="button" onclick="checkPassword()">‚úì</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- M√ÄN H√åNH L·ªúI CH√öC -->
  <div class="birthday-screen" id="birthdayScreen" style="display:none;">
    <div class="wishes-page" id="wishesPage">
      <div class="main-title">
        <h1 class="rainbow-text">üíóCH√öC M·ª™NG SINH NH·∫¨Tüíó</h1>
        <div class="subtitle">Y·∫æN CHIBI 24+++</div>
      </div>

      <div class="birthday-card-section">
        <div class="card-3d">
          <div class="card-imgBox">
            <div class="card-bark"></div>
            <img src="img/gaixenh8.jpg" alt="Birthday">
          </div>
          <div class="card-details">
            <h3>HAPPY BIRTHDAY</h3>
            <p>CH√öC M·ª™NG SINH NH·∫¨T b·∫°n,</p>
            <p>Ch√∫c b·∫°n c√≥ m·ªôt ng√†y sinh nh·∫≠t th·∫≠t vui v·∫ª</p>
            <p>Tu·ªïi m·ªõi ch√∫c b·∫°n g·∫∑p nhi·ªÅu may m·∫Øn h∆°n,</p>
            <p>L√∫c n√†o c≈©ng ph·∫£i c∆∞·ªùi th·∫≠t vui v·∫ª ƒë√≥ nh√©..</p>
            <p>Ch√∫c b·∫°n c√≥ ƒë∆∞·ª£c t·∫•t c·∫£.</p>
            <p>Ch√∫c b·∫°n lu√¥n vui v·∫ª, h·∫°nh ph√∫c.</p>
            <p>Ch√∫c b·∫°n lu√¥n xinh ƒë·∫πp, ƒë√°ng y√™u.</p>
          </div>
        </div>
      </div>

      <!-- N√öT M·ªû QU√Ä -->
      <button class="continue-btn" type="button" onclick="showLetter()">M·ªü qu√† n√®</button>
    </div>
  </div>

  <!-- (N·∫øu b·∫°n c·∫ßn gallery tim) -->
  <div id="heartGallery" class="heart-gallery" style="display:none;"></div>

  <script>
    /*********** C·∫§U H√åNH ***********/
    const CONFIG = {
      password: '17082001', // 8 s·ªë
      useIframe: true,      // d√πng iframe ƒë·ªÉ ph√°t intro
      iframeUrl: 'https://happybirthdaydeargift.vercel.app/?websiteId=689f3af08510730950861d00',
      fallbackDurationMs: 40000, // t·ª± chuy·ªÉn sau 40s
      videoSrc: '',            // n·∫øu mu·ªën ph√°t file video t·ª± host -> nh·∫≠p ƒë∆∞·ªùng d·∫´n ·ªü ƒë√¢y
      openInNewTabIfBlocked: false // ƒë·∫∑t true n·∫øu iframe b·ªã ch·∫∑n -> t·ª± m·ªü tab m·ªõi
    };

    /*********** TI·ªÜN √çCH ***********/
    function qs(id){ return document.getElementById(id); }

    /*********** CALCULATOR ***********/
    const display = qs('display');

    // t·ª± focus khi t·∫£i trang
    document.addEventListener('DOMContentLoaded', () => {
      document.body.classList.remove('preload');
      if (display) display.focus();
    });

    function appendToDisplay(v){
      if(display.value.length < 8) display.value += v;
    }
    function clearDisplay(){
      display.value = '';
    }

    function checkPassword(){
      if(display.value === CONFIG.password){
        qs('calculatorScreen').style.display = 'none';
        showIntroThenWishes();
      } else {
        display.style.animation = 'shake 0.6s ease-in-out';
        setTimeout(() => {
          alert('üå∏ M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng! H√£y th·ª≠ l·∫°i nh√©! üå∏');
          clearDisplay();
          display.style.animation = '';
          display.focus();
        }, 600);
      }
    }

    // Enter ƒë·ªÉ x√°c nh·∫≠n
    display.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') checkPassword();
    });

    /*********** VIDEO/IFRAME FLOW ***********/
    const introOverlay = qs('introOverlay');
    const introFrame   = qs('introFrame');
    const skipBtn      = qs('skipBtn');
    let iframeTimer = null;
    let openedTab = null;

    function showIntroThenWishes(){
      introOverlay.style.display = 'flex';
      document.body.style.overflow = 'hidden';

      // N·∫øu d√πng iframe
      if (CONFIG.useIframe && CONFIG.iframeUrl){
        introFrame.src = CONFIG.iframeUrl;

        // N·∫øu iframe l·ªói -> m·ªü tab (n·∫øu b·∫≠t) r·ªìi qua l·ªùi ch√∫c
        introFrame.addEventListener('error', () => {
          if (CONFIG.openInNewTabIfBlocked) {
            openedTab = window.open(CONFIG.iframeUrl, '_blank', 'noopener,noreferrer');
          }
          endIntroAndShowWishes();
        }, { once:true });

        // D√π sao c≈©ng c√≥ h·∫πn gi·ªù fallback
        iframeTimer = setTimeout(endIntroAndShowWishes, CONFIG.fallbackDurationMs);

      } else if (CONFIG.videoSrc){
        // Ph√°t video t·ª± host
        const wrap = qs('introWrap');
        wrap.innerHTML = '';
        const v = document.createElement('video');
        v.src = CONFIG.videoSrc;
        v.autoplay = true;
        v.playsInline = true;
        v.controls = false;
        v.muted = false; // n·∫øu c·∫ßn auto-play tr√™n mobile c√≥ th·ªÉ c·∫ßn muted=true
        v.addEventListener('ended', endIntroAndShowWishes, { once:true });
        wrap.appendChild(v);
      } else {
        // Kh√¥ng c√≥ g√¨ ƒë·ªÉ ph√°t -> v√†o l·ªùi ch√∫c lu√¥n
        endIntroAndShowWishes();
      }
    }

    function endIntroAndShowWishes(){
      if (iframeTimer){ clearTimeout(iframeTimer); iframeTimer = null; }
      introOverlay.style.display = 'none';
      document.body.style.overflow = '';
      qs('birthdayScreen').style.display = 'block';
    }

    skipBtn.addEventListener('click', endIntroAndShowWishes);

    /*********** N√öT "M·ªû QU√Ä N√à" ***********/
    function showLetter(){
      // chuy·ªÉn sang trang ch√∫c m·ª´ng (ƒë·∫£m b·∫£o c√≥ file chucmung.html)
      window.location.href = 'chucmung.html';
    }
  </script>

  <!-- Script hi·ªáu ·ª©ng c·ªßa b·∫°n (n·∫øu c√≥) -->
  <script src="lang.js"></script>
</body>
</html>
